# 服务器使用技巧

安装 rclone



[toc]

## 目前的 Pipeline

代码管理，主体一般是从github clone的，但自己会增删代码，又不想push。最好是使用云盘来保存

又还有多个集群，需要保持一份代码的最新

这边结束就上传一下





本地调试

集群跑





```shell
# S集群
rclone -P sync /mnt/cache/yangzhiyuan/code/neuralgen onedrive:Cloud-Codes/neuralgen --exclude-from filter-file.txt

# logs
rclone -P sync /mnt/lustre/yangzhiyuan/logs/lod_fmm_srn/stylelodneus_srn_ins=20_bs1x4_warm500_100k_nrays=512_lr=5e-4_wei3e-4_mixlod_epe6_fmmpe10_true onedrive:Cloud-Logs/neuralgen --exclude-from filter-file.txt


# 结束工作后push
rclone -P sync ~/code/neuralgen/ onedrive:Cloud-Codes/neuralgen/ --exclude-from ～/filter-file.txt

```





```shell
# HTGC

# 下载
rclone -P sync ~/code/neuralgen/ onedrive:Cloud-Codes/neuralgen/ --exclude-from ～/filter-file.txt


rclone -P copy onedrive:Cloud-Codes/neuralgen/ ~/code/neuralgen/


rclone -P sync onedrive:Cloud-Logs/neuralgen logs/lod_fmm_srn/stylelodneus_srn_ins=20_bs1x4_warm500_100k_nrays=512_lr=5e-4_wei3e-4_mixlod_epe6_fmmpe10_true 


python -m tools.render.demo_category --mode interpolation --num_views 16 --from_neuralgen ~/code/logs/lod_fmm_srn/stylelodneus_srn_ins=20_bs1x4_warm500_100k_nrays=512_lr=5e-4_wei3e-4_mixlod_epe6_fmmpe10_true
```









# 流畅访问服务器

> 首先是免密码登陆，然后是用什么软件更方便，然后是怎么方便查看和修改代码，然后是怎么方便调参。

## ssh 免密码登陆

1. 本地创建ssh密钥

   ```shell
   ssh-keygen
   ```

2. 上一步最后会提示路径，查看 `id_rsa.pub` 

3. 本地命令行上传密钥

   ```shell
   ssh-copy-id <username>@<remote-server>
   ```

4. 输完一次密码后，以后就不用再输了。



# 云端网盘联动



## 从 onedrive下载内容

网页版onedrive右键获取

https://portland-my.sharepoint.com/:u:/g/personal/zhiyuyang4-c_my_cityu_edu_hk/EdXEmszrZHBIgIINbzA-dusBCxMFrZeTEEWfNSk6mOpj_g?e=eCqvvN

修改末尾为

https://portland-my.sharepoint.com/:u:/g/personal/zhiyuyang4-c_my_cityu_edu_hk/EdXEmszrZHBIgIINbzA-dusBCxMFrZeTEEWfNSk6mOpj_g?download=1

使用wget下载

wget -O <filename.zip> https://portland-my.sharepoint.com/:u:/g/personal/zhiyuyang4-c_my_cityu_edu_hk/EdXEmszrZHBIgIINbzA-dusBCxMFrZeTEEWfNSk6mOpj_g?download=1



https://portland-my.sharepoint.com/:f:/g/personal/zhiyuyang4-c_my_cityu_edu_hk/EqHptRQP6g1DgboYjjYEc1YB2HVO5NBxcEyCvvIgcZ5Q7Q?download=1



SRN 数据集下载 

wget -O srn.zip https://portland-my.sharepoint.com/:u:/g/personal/zhiyuyang4-c_my_cityu_edu_hk/EVLISOZhNqdIj3JqpYVMTpcBODIawWnEVli9x8Ariw_xCQ?download=1

## 上传到 onedrive



rclone move /mnt/cache/<user_name>/code/<path to your files> onedrive:/folder

https://rclone.org/remote_setup/



```shell
rclone -P sync onedrive:Github/Code/neuralgen /mnt/lustre/yangzhiyuan/test

--dry-run

# 因为只会改变目标路径文件
rclone sync onedrive:rnbak/database /www/backup/database
```



挂载 

先创建一个文件夹

rclone mount onedrive:Github/Code/neuralsim ./neuralsim --vfs-cache-mode writes、





文件过滤

--exclude 排除文件或目录

```shell
--filter-from filter-file.txt
```





```shell
rclone sync - 同步 将源目录同步到目标目录，只更改目标目录。


rclone -P --filter-from filter-file.txt sync mnt/cache/yangzhiyuan/code/neuralgen onedrive:Github/Cloud-Codes/neuralgen 

rclone -P sync ~/code/neuralgen/ onedrive:Cloud-Codes/neuralgen/ --exclude-from filter-file.txt

--exclude=.git/

 
```





## 从 google drive下载内容

wget 直接下载就好了



gdown https://drive.google.com/uc?id=1bRB4-KxQplJryJvqyEa8Ixkf_BVm4Nn6

gdown https://drive.google.com/u/0/uc?id=1bRB4-KxQplJryJvqyEa8Ixkf_BVm4Nn6

## 上传到 google drive



python extract_shapes.py CelebA/generator.pth
